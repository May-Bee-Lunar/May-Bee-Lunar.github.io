<!DOCTYPE html>
<html>
    <head>
        <title>
            MayOS!
        </title>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
        <style>

            :root {
                --backgroundcolor: #dddddd;
                --windowtextcolor: #000000;
                --windowbordercolor: #aaaaaa;
                --windowcolor: #dddddd;
                --secondarywindowcolor: #aaaaaa;
                --toolbartextcolor: #dddddd;
                --toolbarbordercolor: #222222;
                --toolbarcolor: #444444;
            }



            body {
                background-color: var(--backgroundcolor);
                font-family: "Noto Sans", sans-serif;
                overflow: hidden;
                color: var(--windowtextcolor)
            }



            .icon {
                position: absolute;
                width: 128px;
                height: 128px;
            }

            /* #region Window styling */
            .window {
                position: absolute;
            }

            .resizegrid {
                position: absolute;
                display: grid;
                grid-template-columns: 8px 1fr 8px;
                grid-template-rows: 8px 1fr 8px;

                pointer-events: none;

                width: 100%;
                height: 100%;
            }
            .resizehandle {
                pointer-events: all;
            }

            .windowcontent {
                position: absolute;
                display: flex;
                flex-direction: column;
                
                width: 100%;
                height: 100%;
            }
            .toolbar {
                background-color: var(--toolbarcolor);
                height: 32px;

                border: 4px solid var(--toolbarbordercolor);
                border-top-left-radius: 16px;
                border-top-right-radius: 16px;

                padding: 16px;

                display: flex;
                justify-content: space-between;

                color: var(--toolbartextcolor);
                font-size: 2em;
            }
            .innerwindow {
                flex-grow: 1;
                flex-shrink: 1;
                /* huh how did this work??? */
                height: 100px;

                background-color: var(--windowcolor);

                border: 4px solid var(--windowbordercolor);
                border-bottom-right-radius: 4px;
                border-bottom-left-radius: 4px;
                border-top-width: 0px;

                display: flex;
                flex-direction: column;
            }
            /* #endregion */

            /* #region Home styling */
            .homewindow {
                padding: 32px;
                height: 100%;
                text-align: center;
                align-content: center;
                overflow-y: auto;
            }
            /* #endregion */

            /* #region Settings styling */
            .settingswindow {
                display: flex;
                align-items: stretch;
                flex-direction: column;

                width: 100%;
                height: 100%;
            }

            .settingstablist {
                flex: 0 0 32px;
                background-color: var(--secondarywindowcolor);
                display: flex;
                height: 32px;
            }
            .settingstab {
                flex: 100px 1;
                text-align: center;
                align-content: center;
            }
            .selectedsettingstab {
                background-color: var(--windowcolor);
            }
            .settingsmainsection {
                flex: 1;
                height: 100px;

                display: flex;
            }
            .settingspreview {
                flex: 1 1;
                background-color: var(--secondarywindowcolor);
                text-align: center;
                align-content: center;
                overflow-y: auto;
            }
            .settingsoptionslist {
                flex: 2;

                padding: 32px;
                display: grid;
                grid-template-columns: 1fr 1fr;
                justify-items: center;
                overflow-y: auto;
            }

            .settingsconfirmsection {
                flex: 0 32px;
                background-color: var(--secondarywindowcolor);
                text-align: center;
                align-content: center;
            }
            /* #endregion */
        
            /* #region Diary styling */
            .diarywindow {
                height: 100%;
                overflow-y: auto;

                display: flex;
                flex-direction: column;
            }

            .diarysearchsection {
                flex: 0 0 32px;
                display: flex;
            }
            .diarysearchbar {
                flex: 1;
            }
            .diarysearchbutton {
                flex: 0 0 100px;
            }
            .diaryfilterbutton {
                flex: 0 0 100px;
            }

            .diaryfiltersection {
                padding: 32px;
                text-align: center;
                background-color: var(--secondarywindowcolor);
            }

            .diarycategoriessection {
                display: flex;
                flex-wrap: wrap;
                column-gap: 16px;
                justify-content: center;
            }
            .diarycategory {
                white-space: nowrap;
            }

            .diarydatesection {
                display: flex;
            }
            .diarydateinput {
                width: 50px;
                flex: 1;
            }

            .diarylengthsection {
                display: flex;
            }
            .diarylengthinput {
                width: 50px;
                flex: 1;
            }

            .diarysortsection {
                display: flex;
                flex-wrap: wrap;
                column-gap: 16px;
                justify-content: center;
            }
            .diarysortoption {
                white-space: nowrap;
            }
            
            .diarymainsection {
                flex: 1;
                padding: 32px;
                display: flex;
                flex-direction: column;
                gap: 16px;
            }
            .diarypreviewcard {
                background-color: var(--secondarywindowcolor);
                text-align: center;
                padding: 16px;
            }
            /* #endregion */

            .deactive {
                display: none;
            }
        </style>
    </head>
    <body>
        <img class="icon" id="home" style="left: 50px; top: 50px;" src="homeicon.webp">
        <img class="icon" id="settings" style="left: 50px; top: 200px;" src="settingsicon.webp">
        <img class="icon" id="diary" style="left: 50px; top: 350px;" src="diaryicon.webp">

        <div class="windowlist">
            <!--
            <div class="window" style="width: 800px; height: 600px; z-index: 0; left: 20px; top: 20px;">
                <div class="windowcontent">
                    <div class="toolbar">
                        <div class="title">Placeholder Window</div>
                        <div class="closebutton">✕</div>
                    </div>
    
                    <div class="innerwindow">

                        You know there is a problem when most of the html is in strings in javascript, lol.

                    </div>
                </div>

                <div class="resizegrid">
                    <div class="resizehandle" id="nw"></div>
                    <div class="resizehandle" id="n"></div>
                    <div class="resizehandle" id="ne"></div>
                    <div class="resizehandle" id="w"></div>
                    <div class="filler"></div>
                    <div class="resizehandle" id="e"></div>
                    <div class="resizehandle" id="sw"></div>
                    <div class="resizehandle" id="s"></div>
                    <div class="resizehandle" id="se"></div>
                </div>
            </div>
            -->
        </div>

        <script>

            let selectedElement = null;
            latestWindowZ = 0;

            // please tell me if there is a better way to store my blogs...
            let diaryEntries = [
                {
                    date: new Date("2025-6-4"),
                    title: "First diary entry!",
                    description: "I'm not quite sure what to put here. (not real entry)",
                    categories: ["update", "project", "advertisement", "other"],
                    length: 2,
                    entry: "<p>What do I even put?</p>"
                },
                {
                    date: new Date("2025-6-5"),
                    title: "Second diary entry!",
                    description: "Yeah, these diary entries are just for testing. (not real entry)",
                    categories: ["update", "advertisement", "other"],
                    length: 7,
                    entry: "<p>I have no intention of actually writing a 7 minute entry lol</p>"
                },
                {
                    date: new Date("2025-6-6"),
                    title: "Third diary entry!",
                    description: "This is actually a blog, not a diary... (not real entry)",
                    categories: ["advertisement", "other"],
                    length: 6,
                    entry: "<p>I picked the minute numbers based on the number 2763, which is a very cool number.</p>"
                },
                {
                    date: new Date("2025-6-7"),
                    title: "Fourth diary entry!",
                    description: "Four is my favorite number! (not real entry)",
                    categories: ["update", "project"],
                    length: 3,
                    entry: "<p>I hope I put more effort into future diary entries.</p><p>well um i guess this is the future since apparently the diary entry was written 2 days in the future. well by the time you are reading this idk when it will be... ok uh bye I guess!</p>"
                },
                {
                    date: new Date("2025-6-5"),
                    title: "dream",
                    description: "why do i dream weird stuff",
                    categories: ["other"],
                    length: 1,
                    entry: `
                    <div style="overflow-y: auto;">
                    <img src="dream.webp" style="width: 100%">
                        <p style="margin: 32px;">
                            I was in a maze of corridors where everything seemed to curve upwards.
                            Almost like a world where gravity was inverted and I was near the center.
                            The halls seemed to be cut into different colored sections.
                            Near the intersection of orange, yellow, and green, there was a hall from my middle school.
                            In there was a classroom, where we found
                        </p>
                    </div>`
                },
                {
                    date: new Date("2025-6-5"),
                    title: "Update 1! :D",
                    description: "Added a blog, stylized as a diary!",
                    categories: ["other"],
                    length: 1,
                    entry: `
                    <div style="overflow-y: auto;">
                    <img src="update1.webp" style="width: 100%">
                        <div style="padding: 32px;">
                            <p>Hey, you are reading what I added!</p>
                            <p>
                                This update basically just added the diary.
                                You might be wondering, "how come this is update 1? You made updates before this!"
                                and my response is that this is the first update because it's the first one where I bothered to actually number it. ¯\\_(ツ)_/¯
                            </p>
                            <p>
                                (p.s. The girl in the image is Bay, my self-insert semi-mascot!
                                Also she has the power to change colors, because... self-insert powers! She's normally gray.)
                            </p>
                        </div>
                    </div>`
                }
            ]
            
            // Selects an element
            document.addEventListener("mousedown", (event) => {
                selectedElement = event.target;

                // Prevent text highlighting if the selected element is any in the array
                if (["toolbar", "closebutton", "resizehandle"].includes(selectedElement.className)) {
                    event.preventDefault();
                }

                // #region Move window to the front when clicked
                let testElement = selectedElement;
                while (testElement.nodeName != "HTML" && testElement.className != "window") {
                    testElement = testElement.parentElement;
                }
                if (testElement.className == "window") {
                    if (testElement.style.zIndex < latestWindowZ) {
                        latestWindowZ++;
                        testElement.style.zIndex = latestWindowZ
                    }
                }
                // #endregion

                
            });



            // Window moving and resizing
            document.addEventListener("mousemove", (event) => {
                if (selectedElement == null) {
                    // Changes mouse to represent the action
                    switch(event.target.className.split(' ')[0]) {
                        case "toolbar":
                            document.body.style.cursor = "move";
                            break;
                        case "resizehandle":
                            document.body.style.cursor = event.target.id + "-resize";
                            break;
                        default:
                            document.body.style.cursor = "default";
                            break;
                    }
                
                } else {

                    // Perform an action is an element is selected, based on the selected element
                    switch(selectedElement.className.split(' ')[0]) {
                        // Move windows
                        case "toolbar":
                            windowElement = selectedElement.parentElement.parentElement;
                            
                            windowElement.style.left = clamp(pxtonum(windowElement.style.left) + event.movementX, 0, window.innerWidth - pxtonum(windowElement.style.width)) + "px";
                            windowElement.style.top = clamp(pxtonum(windowElement.style.top) + event.movementY, 0, window.innerHeight - pxtonum(windowElement.style.height)) + "px";
                            
                            break;

                        // Resize windows
                        case "resizehandle":
                            windowElement = selectedElement.parentElement.parentElement;

                            if (selectedElement.id.slice(-1) == "e") {
                                windowElement.style.width = clamp(pxtonum(windowElement.style.width) + event.movementX, 400, window.innerWidth - pxtonum(windowElement.style.left)) + "px";
                            } else if (selectedElement.id.slice(-1) == "w") {
                                let leftEdge = clamp(pxtonum(windowElement.style.left) + event.movementX, 0, pxtonum(windowElement.style.left) + pxtonum(windowElement.style.width) - 400)
                                let rightEdge = pxtonum(windowElement.style.width) + pxtonum(windowElement.style.left);
                                windowElement.style.width = rightEdge - leftEdge + "px";
                                windowElement.style.left = leftEdge + "px";
                            }

                            if (selectedElement.id.slice(0, 1) == "s") {
                                windowElement.style.height = clamp(pxtonum(windowElement.style.height) + event.movementY, 300, window.innerHeight - pxtonum(windowElement.style.top)) + "px";
                            } else if (selectedElement.id.slice(0, 1) == "n") {
                                let topEdge = clamp(pxtonum(windowElement.style.top) + event.movementY, 0, pxtonum(windowElement.style.top) + pxtonum(windowElement.style.height) - 300)
                                let bottomEdge = pxtonum(windowElement.style.height) + pxtonum(windowElement.style.top);
                                windowElement.style.height = bottomEdge - topEdge + "px";
                                windowElement.style.top = topEdge + "px";
                            }

                            break;
                    }
                }
            })



            // Deselects any selected element
            document.addEventListener("mouseup", (event) => {
                selectedElement = null;
            })



            // Perform an action when something is clicked
            document.addEventListener("click", (event) => {
                switch(event.target.className.split(' ')[0]) {
                    // Close a window
                    case "closebutton":
                        event.target.parentElement.parentElement.parentElement.remove()
                        break;

                    // Open a window based on the icon clicked
                    case "icon":
                        switch(event.target.id) {
                            case "home":
                                newWindow(800, 600, "Home", `
                                <div class="homewindow">
                                    <div class="hometext">
                                        <header style="font-size: 4em;">Hey, I'm May!</header>
                                        <p>(My pronouns are she/it ☆*:.｡.o(≧▽≦)o.｡.:*☆)</p>
                                        <p>Please start with changing the settings to your likings (unless you wanna live in perpetual grayscale...) After that, currently there isn't much to do, but I'll add more, I promise!</p>
                                        <p>(Site inspired by <a href="https://github.com/syxanash/awesome-web-desktops">web desktops</a>, but still kinda my own thing! I first saw <a href="https://www.sharyap.com/">shar's site</a>, so that's mostly my inspiration-ish. Also the general concept of a desktop I guess.)</p>
                                        <header style="font-size: 2em;">About me</header>
                                        <p>I'm (kinda... still mostly a beginner) an artist, programmer, and hopefully more soon!
                                            Other than that... there isn't much about me (;-;) I'm very boring.
                                            I guess I like carrots, strawberries, and blahaj.
                                        </p>
                                    </div>
                                </div>
                                `)
                                break;
                            case "settings":
                                let rootstyles = getComputedStyle(document.querySelector(":root"))
                                newWindow(800, 600, "System Settings", `
                                <div class="settingswindow">
                                    <div class="settingstablist">
                                        <div class="settingstab selectedsettingstab" id="visual">Visual</div>
                                        <div class="settingstab" id="audio">Audio</div>
                                        <div class="settingstab" id="other">Other</div>
                                        <div class="settingstab" id="info">Info</div>
                                    </div>
                                    <div class="settingsmainsection">
                                        <div class="settingspreview">
                                            No option selected!
                                        </div>
                                        <div class="settingsoptionslist" id="visual">
                                            <label for="backgroundcolor` + latestWindowZ + `">Background color:</label>
                                            <input type="color" class="backgroundcolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--backgroundcolor") + `" id="backgroundcolor` + latestWindowZ + `">
                                            <label for="windowcolor` + latestWindowZ + `">Window color:</label>
                                            <input type="color" class="windowcolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--windowcolor") + `" id="windowcolor` + latestWindowZ + `">
                                            <label for="secondarywindowcolor` + latestWindowZ + `">Secondary window color:</label>
                                            <input type="color" class="secondarywindowcolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--secondarywindowcolor") + `" id="secondarywindowcolor` + latestWindowZ + `">
                                            <label for="windowbordercolor` + latestWindowZ + `">Window border color:</label>
                                            <input type="color" class="windowbordercolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--windowbordercolor") + `" id="windowbordercolor` + latestWindowZ + `">
                                            <label for="windowtextcolor` + latestWindowZ + `">Window text color:</label>
                                            <input type="color" class="windowtextcolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--windowtextcolor") + `" id="windowtextcolor` + latestWindowZ + `">
                                            <label for="toolbarcolor` + latestWindowZ + `">Toolbar color:</label>
                                            <input type="color" class="toolbarcolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--toolbarcolor") + `" id="toolbarcolor` + latestWindowZ + `">
                                            <label for="toolbarbordercolor` + latestWindowZ + `">Toolbar border color:</label> <input type="color" class="toolbarbordercolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--toolbarbordercolor") + `" id="toolbarbordercolor` + latestWindowZ + `">
                                            <label for="toolbartextcolor` + latestWindowZ + `">Toolbar text color:</label>
                                            <input type="color" class="toolbartextcolor" oninput="windowPreview(this)" value="` + rootstyles.getPropertyValue("--toolbartextcolor") + `" id="toolbartextcolor` + latestWindowZ + `">
                                        </div>
                                        <div class="settingsoptionslist deactive" id="audio">Nothing here yet!</div>
                                        <div class="settingsoptionslist deactive" id="other">Nothing here yet!</div>
                                        <div class="settingsoptionslist deactive" id="info">
                                            <p>Operating System:</p><p>mayOS</p>
                                            <p>Developer:</p><p>May</p>
                                            <p style="grid-column: 1 / 3">And most importantly... NO AI!!!</p>
                                            <p style="grid-column: 1 / 3">Also, any help would be welcome! :D (no pay/compensation tho (I'm broke ;-;) so it's ok if not.)</p>
                                            <a style="grid-column: 1 / 3" href="https://github.com/May-Bee-Lunar/May-Bee-Lunar.github.io">https://github.com/May-Bee-Lunar/May-Bee-Lunar.github.io</a>
                                            <p style="grid-column: 1 / 3">Also, clearing your web cache or local storage or whatever will delete ALL PROGRESS! (i'll add stuff to make progress on later) So... don't do that :/</p>
                                        </div>
                                    </div>
                                    <div class="settingsconfirmsection deactive">
                                        You have unsaved changes! <input type="button" value="Save" class="settingsconfirmbutton">
                                    </div>
                                </div>
                                `)
                                break;
                            case "diary":
                                newWindow(800, 600, "May's diary", `
                                <div class="diarywindow">
                                    <div class="diarysearchsection">
                                        <input type="search" class="diarysearchbar">
                                        <input type="button" class="diarysearchbutton" value="Search">
                                        <input type="button" class="diaryfilterbutton" value="Filters">
                                    </div>
                                    <div class="diaryfiltersection deactive">
                                        <header style="font-size: 1.5em;">Categories:</header>
                                        <div class="diarycategoriessection">
                                            <div class="diarycategory">
                                                <label for="diarycategoryupdate` + latestWindowZ + `">Updates:</label>
                                                <input class="diarycategoryupdate" type="checkbox" id="diarycategoryupdate` + latestWindowZ + `" checked>
                                            </div>
                                            <div class="diarycategory">
                                                <label for="diarycategoryproject` + latestWindowZ + `">Projects:</label>
                                                <input class="diarycategoryproject" type="checkbox" id="diarycategoryproject` + latestWindowZ + `" checked>
                                            </div>
                                            <div class="diarycategory">
                                                <label for="diarycategoryadvertisement` + latestWindowZ + `">Advertisements:</label>
                                                <input class="diarycategoryadvertisement" type="checkbox" id="diarycategoryadvertisement` + latestWindowZ + `" checked>
                                            </div>
                                            <div class="diarycategory">
                                                <label for="diarycategoryother` + latestWindowZ + `">Other:</label>
                                                <input class="diarycategoryother" type="checkbox" id="diarycategoryother` + latestWindowZ + `" checked>
                                            </div>
                                        </div>
                                        <header style="font-size: 1.5em;">Date:</header>
                                        <div class="diarydatesection">
                                            <input class="diarystartdate diarydateinput" type="text" placeholder="From" onfocus="(this.type='date')" onblur="(this.type='text')">
                                            &nbsp;to&nbsp;
                                            <input class="diaryenddate diarydateinput" type="text" placeholder="To" onfocus="(this.type='date')" onblur="(this.type='text')">
                                        </div>
                                        <header style="font-size: 1.5em;">Reading Time:</header>
                                        <div class="diarylengthsection">
                                            <input class="diaryminimumlength diarylengthinput" id="diaryminimumlength` + latestWindowZ + `" type="number" placeholder="(minutes)">
                                            <label for="diaryminimumlength` + latestWindowZ + `">&nbsp;minutes</label>
                                            &nbsp;-&nbsp;
                                            <input class="diarymaximumlength diarylengthinput" id="diarymaximumlength` + latestWindowZ + `" type="number" placeholder="(minutes)">
                                            <label for="diarymaximumlength` + latestWindowZ + `">&nbsp;minutes</label>
                                        </div>
                                        <header style="font-size: 1.5em;">Sort:</header>
                                        <div class="diarysortsection">
                                            <div class="diarysortoption">
                                                <label for="latest` + latestWindowZ + `">Latest:</label>
                                                <input type="radio" value="latest" id="latest` + latestWindowZ + `" name="diarysort` + latestWindowZ + `" checked>
                                            </div>
                                            <div class="diarysortoption">
                                                <label for="oldest` + latestWindowZ + `">Oldest:</label>
                                                <input type="radio" value="oldest" id="oldest` + latestWindowZ + `" name="diarysort` + latestWindowZ + `">
                                            </div>
                                            <div class="diarysortoption">
                                                <label for="alphabeticallyascending` + latestWindowZ + `">Alphabetically (A-Z):</label>
                                                <input type="radio" value="alphabeticallyascending" id="alphabeticallyascending` + latestWindowZ + `" name="diarysort` + latestWindowZ + `">
                                            </div>
                                            <div class="diarysortoption">
                                                <label for="alphabeticallydescending` + latestWindowZ + `">Alphabetically (Z-A):</label>
                                                <input type="radio" value="alphabeticallydescending" id="alphabeticallydescending` + latestWindowZ + `" name="diarysort` + latestWindowZ + `">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="diarymainsection">
                                        Welcome to my diary! Start with searching for diary entries!
                                    </div>
                                </div>
                                `)
                                break;
                        }
                        break;
                
                    // #region Settings page
                    case "settingstab":
                        (event.target.parentElement.querySelectorAll(".settingstab")).forEach(element => {
                            element.classList.remove("selectedsettingstab");
                        });
                        event.target.parentElement.parentElement.querySelector(".settingsmainsection").querySelectorAll(".settingsoptionslist").forEach(element => {
                            element.classList.add("deactive");
                        });
                        
                        event.target.parentElement.parentElement.querySelector(".settingsmainsection").querySelector("#" + event.target.id).classList.remove("deactive");

                        event.target.classList.add("selectedsettingstab");
                        break;
                    case "settingsconfirmbutton":
                        
                        let settings = {};
                        event.target.parentElement.parentElement.querySelector(".settingsmainsection").querySelectorAll("input").forEach((element) => {
                            document.querySelector(":root").style.setProperty("--" + element.className, element.value);
                            settings[element.className] = element.value;
                        })

                        localStorage.setItem("settings", JSON.stringify(settings));

                        event.target.parentElement.classList.add("deactive");
                        break;
                    // #endregion

                    // #region Diary page
                    case "diaryfilterbutton":
                        event.target.parentElement.parentElement.querySelector(".diaryfiltersection").classList.toggle("deactive");
                        break;

                    case "diarysearchbutton":
                        let diaryFilterSection = event.target.parentElement.parentElement.querySelector(".diaryfiltersection");
                        let filteredDiaryEntries = diaryEntries.slice();

                        let searchCategories = [];
                        diaryFilterSection.querySelector(".diarycategoriessection").querySelectorAll("input").forEach(category => {
                            if (category.checked) {
                                searchCategories.push(category.className.slice(13));
                            }
                        })
                        filteredDiaryEntries = filteredDiaryEntries.filter((diaryEntry) => diaryEntry.categories.some(category => searchCategories.includes(category)));

                        let minimumDate = new Date(diaryFilterSection.querySelector(".diarydatesection").querySelector(".diarystartdate").value);
                        if (minimumDate != "Invalid Date") {
                            filteredDiaryEntries = filteredDiaryEntries.filter((diaryEntry) => minimumDate <= diaryEntry.date);
                        }
                        let maximumDate = new Date(diaryFilterSection.querySelector(".diarydatesection").querySelector(".diaryenddate").value);
                        if (maximumDate != "Invalid Date") {
                            // I have no idea why the date is a day behind but idc.
                            filteredDiaryEntries = filteredDiaryEntries.filter((diaryEntry) => diaryEntry.date <= maximumDate.getTime() + (24 * 60 * 60 * 1000));
                        }

                        let minimumlength = diaryFilterSection.querySelector(".diarylengthsection").querySelector(".diaryminimumlength").value;
                        if (minimumlength) {
                            filteredDiaryEntries = filteredDiaryEntries.filter((diaryEntry) => minimumlength <= diaryEntry.length);
                        }
                        let maximumlength = diaryFilterSection.querySelector(".diarylengthsection").querySelector(".diarymaximumlength").value;
                        if (maximumlength) {
                            filteredDiaryEntries = filteredDiaryEntries.filter((diaryEntry) => diaryEntry.length <= maximumlength);
                        }

                        let searchQuery = diaryFilterSection.parentElement.querySelector(".diarysearchsection").querySelector(".diarysearchbar").value;
                        if (searchQuery) {
                            filteredDiaryEntries = filteredDiaryEntries.filter((diaryEntry) => diaryEntry.description.toLowerCase().includes(searchQuery.toLowerCase()) || diaryEntry.title.toLowerCase().includes(searchQuery.toLowerCase()))
                        }

                        let sortMode = diaryFilterSection.querySelector(".diarysortsection").querySelector("input:checked").value
                        switch (sortMode) {
                            case "latest":
                                filteredDiaryEntries.sort((diaryEntry1, diaryEntry2) => diaryEntry2.date.getTime() - diaryEntry1.date.getTime());
                                break;
                            case "oldest":
                                filteredDiaryEntries.sort((diaryEntry1, diaryEntry2) => diaryEntry1.date.getTime() - diaryEntry2.date.getTime());
                                break;

                            // who ever actually uses alphabetical sorting
                            case "alphabeticallyascending":
                                filteredDiaryEntries.sort((diaryEntry1, diaryEntry2) => diaryEntry1.title.localeCompare(diaryEntry2.title));
                                break;
                            case "alphabeticallydescending":
                                filteredDiaryEntries.sort((diaryEntry1, diaryEntry2) => diaryEntry2.title.localeCompare(diaryEntry1.title));
                                break;
                        }

                        let diaryMainSection = diaryFilterSection.parentElement.querySelector(".diarymainsection");
                        diaryMainSection.innerHTML = "";
                        filteredDiaryEntries.forEach((diaryEntry) => {
                            let newDiaryPreviewCard = document.createElement("div");
                            newDiaryPreviewCard.classList.add("diarypreviewcard");
                            newDiaryPreviewCard.innerHTML = `
                            <header style="font-size: 2em;">` + diaryEntry.title + `</header>
                            <p>` + diaryEntry.description + `</p>
                            <p>Categories: ` + diaryEntry.categories.map((category) => category.charAt(0).toUpperCase() + category.slice(1)).join(", ") + ` • Est. reading time: ` + diaryEntry.length + ` min • ` + diaryEntry.date.toLocaleDateString("en-US", {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'}) + `
                            `
                            newDiaryPreviewCard.addEventListener("click", () => newWindow(800, 600, diaryEntry.title, diaryEntry.entry));
                            diaryMainSection.appendChild(newDiaryPreviewCard);
                        })

                        if (filteredDiaryEntries.length == 0) {
                            diaryMainSection.innerHTML = "No entries found!"
                        }
                        

                        console.log(filteredDiaryEntries);
                        break;
                    // #endregion Diary page
                }
            })



            // Shows the window preview for settings
            function windowPreview(element) {
                let settingsOptionsList = element.parentElement
                let settingsMainSection = settingsOptionsList.parentElement;
                settingsMainSection.querySelector(".settingspreview").innerHTML = `
                <div style="width: 100%; height: 100%; align-content: center; background-color: ` + settingsOptionsList.querySelector(".backgroundcolor").value + `; text-align: center;">
                    <div class="windowpreview" style="display: flex; flex-direction: column; margin: 32px;">
                        <div class="toolbarpreview" 
                        style="background-color: ` + settingsOptionsList.querySelector(".toolbarcolor").value +`;
        
                        border: 4px solid ` + settingsOptionsList.querySelector(".toolbarbordercolor").value + `;
                        border-top-left-radius: 16px;
                        border-top-right-radius: 16px;
        
                        padding: 16px;
                        color: ` + settingsOptionsList.querySelector(".toolbartextcolor").value + `;
                        font-size: 2em;">
                            Title!
                        </div>
                        <div class="innerwindowpreview" style="background-color: ` + settingsOptionsList.querySelector(".windowcolor").value + `;
                        border: 4px solid ` + settingsOptionsList.querySelector(".windowbordercolor").value + `;
                        border-bottom-right-radius: 4px;
                        border-bottom-left-radius: 4px;
                        border-top-width: 0px;
                        color: ` + settingsOptionsList.querySelector(".windowtextcolor").value + `;
                        flex-grow: 1;
                        display: flex;
                        flex-direction: column;">
                            <div style="background-color: ` + settingsOptionsList.querySelector(".windowcolor").value + `; padding: 16px; flex: 1;">
                                This is some sample text! Pretty cool, right?
                            </div>
                            <div style="background-color: ` + settingsOptionsList.querySelector(".secondarywindowcolor").value + `; padding: 16px; flex: 1;">
                                This is sample text with a secondary background!
                            </div>
                        </div>
                    </div>
                </div>
                `

                element.parentElement.parentElement.parentElement.querySelector(".settingsconfirmsection").classList.remove("deactive");
            }

            // Get the settings options from local storage
            if (localStorage.getItem("settings")) {
                let settings = JSON.parse(localStorage.getItem("settings"));
                for (let key in settings) {
                    document.querySelector(":root").style.setProperty("--" + key, settings[key]);
                }
            }

            // Make a new window
            // edit: so unfortunately i got a bad case of "stupid" because apparently i could've just... linked to a website instead of trying to replicate one... oh well i'll keep the system i have currently, sure hope it doesn't screw me over later! hah
            function newWindow(width, height, title, htmlstuff) {
                let newWindow = document.createElement("div");
                newWindow.classList.add("window");
                newWindow.innerHTML = `
                <div class="windowcontent">
                    <div class="toolbar">
                        <div class="title">` + title + `</div>
                        <div class="closebutton">✕</div>
                    </div>
    
                    <div class="innerwindow">` + htmlstuff + `</div>
                </div>

                <div class="resizegrid">
                    <div class="resizehandle" id="nw"></div>
                    <div class="resizehandle" id="n"></div>
                    <div class="resizehandle" id="ne"></div>
                    <div class="resizehandle" id="w"></div>
                    <div class="filler"></div>
                    <div class="resizehandle" id="e"></div>
                    <div class="resizehandle" id="sw"></div>
                    <div class="resizehandle" id="s"></div>
                    <div class="resizehandle" id="se"></div>
                </div>`
                latestWindowZ++;
                newWindow.style = "width: " + width + "px; height: " + height + "px; z-index: " + latestWindowZ + "; left: " + (window.innerWidth - width) / 2 + "px; top: " + (window.innerHeight - height) / 2 + "px;"
                document.querySelector(".windowlist").appendChild(newWindow)
            }

            // Turns "__px" into a usable number for calculations
            function pxtonum(string) {return Number(string.slice(0, -2));}
            
            // Clamp a number
            function clamp(number, min, max) {return number > max ? max : number < min ? min : number;}

        </script>
    </body>
</html>
